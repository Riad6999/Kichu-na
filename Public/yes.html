<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Knew you would say yes!</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Great+Vibes&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/yes.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
</head>
<body>
  <div class="yes-wrap">
    <div class="overlay"></div>

    <header class="yes-header">
      <h1 class="hero-title"><span class="script">I knew you'll say</span><br> <strong>YES</strong></h1>
      <p class="lead">Let's create a memory so beautiful they'll be jealous.</p>
    </header>

    <main class="yes-main">
      <div class="card">
        <div class="gifbox">
          <img src="https://media4.giphy.com/media/9XY4f3FgFTT4QlaYqa/giphy.gif" alt="celebration gif">
        </div>

        <div class="pick-section" id="datePickerSection">
          <h2>Pick a date for our moment</h2>
          <input id="datePicker" type="datetime-local" />
          <div class="controls">
            <button class="btn-confirm" onclick="confirmDate()">Save to My Heart ‚ù§Ô∏è</button>
            <button class="btn-muted" id="playMusicBtn" onclick="toggleMusic()">Play music ‚ñ∂</button>
          </div>
        </div>

        <div id="whatsappSection" style="display:none;">
          <p class="share-note">Everything set! Share our plan with a simple tap.</p>
          <button class="btn-whatsapp" onclick="shareToWhatsApp()">Send Our Date to WhatsApp</button>
        </div>
      </div>
    </main>

    <footer class="yes-footer">See you soon ‚ú®</footer>
  </div>

  <audio id="bgMusic" loop preload="auto">
    <!-- To enable: place a file named bg-music.mp3 into /public and uncomment below -->
    <!-- <source src="/bg-music.mp3" type="audio/mpeg"> -->
  </audio>

  <script>
    let selectedDate = '';
    const phoneNumber = '+966502681629'; // your number

    function confirmDate(){
      const input = document.getElementById('datePicker');
      selectedDate = input.value;

      if(!selectedDate){
        Swal.fire({
          title: 'Pick a date first',
          text: 'Please choose the perfect day for us ‚ú®',
          icon: 'info'
        });
        return;
      }

      Swal.fire({
        title: 'Saved to my heart',
        text: 'That day just became my favorite. üíñ',
        icon: 'success',
        confirmButtonText: 'Lovely'
      }).then(()=>{
        document.getElementById('datePickerSection').style.display = 'none';
        document.getElementById('whatsappSection').style.display = 'block';
      });
    }

    function shareToWhatsApp(){
      try {
        const dt = new Date(selectedDate);
        const formatted = dt.toLocaleString('en-GB', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });

        const text = `I can make ${formatted} special with you ‚ù§Ô∏è`;
        const url = `https://wa.me/${phoneNumber.replace(/\D/g,'')}?text=${encodeURIComponent(text)}`;

        window.open(url, '_blank');
      } catch (err) {
        Swal.fire('Oops', 'Something went wrong. Try again please.', 'error');
      }
    }

    const audio = document.getElementById('bgMusic');
    const playBtn = document.getElementById('playMusicBtn');

    function toggleMusic(){
      if(!audio.querySelector('source')){
        Swal.fire({
          title:'Music not found',
          text:'To enable background music, add a file named bg-music.mp3 to the folder.',
          icon:'info'
        });
        return;
      }
      if(audio.paused){
        audio.play();
        playBtn.textContent = 'Pause music ‚ùö‚ùö';
      } else {
        audio.pause();
        playBtn.textContent = 'Play music ‚ñ∂';
      }
    }

    // show visitor info if stored in sessionStorage
    document.addEventListener('DOMContentLoaded', ()=> {
      const v = JSON.parse(sessionStorage.getItem('visitor') || 'null');
      if(v){
        const info = `${v.ip || '‚Äî'} ¬∑ ${v.geo?.city || ''} ${v.geo?.region || ''} ${v.geo?.country || ''} ¬∑ ${v.ua || '‚Äî'}`;
        const note = document.createElement('div');
        note.style.textAlign = 'center';
        note.style.marginTop = '12px';
        note.textContent = 'Visitor: ' + info;
        document.querySelector('.yes-main .card').prepend(note);
      }
    });
  </script>
</body>
</html>
